<dom-module id="quota-manage">
    <template>
        <style include="page-style">
            div.container{
                @apply(--layout-vertical);
            }
            div.container > div.from {
               @apply(--layout-horizontal);
            }
            div.container > div.from > div.label {
                @apply(--layout-flex);
                text-align :right;
                padding-top: 15px;
                padding-right: 15px;
            }
            div.container > div.from > div.input {
                @apply(--layout-flex-3);
            }
            div.container > div.btn {
                @apply(--layout-horizontal);
                @apply(--layout-center-justified);
            }
            div.container > div.from div.input > gl-form-input{
                width: 60%;
            }
        </style>
        <div class="container"> 
            <div class="from">
              <div class="label">
                    <label for="year">ปีโควต้า :</label>
                </div>
                <div class="input">
                    [[changeString2Num(select.*,'year')]]
                    <gl-form-input id='year'no-label-float value="{{select.year}}" disabled="[[disable]]"></gl-form-input>
                </div>
            </div>
            <div class="from">
               <div class="label">
                    <label for="year">ปริมาณ (ตัน) :</label>
                </div>
                <div class="input">
                    [[changeString2Num(select.*,'quality')]]
                    <gl-form-input id='year'no-label-float value="{{select.quality}}" disabled="[[disable]]"></gl-form-input>
                </div>
            </div>
            <div class="btn">
                  <paper-button class="gl-btn-info" on-tap="calPeriod" raised>คำนวนปริมาณต่องวด</paper-button>
              </div>
             <template is="dom-repeat" items="[[select.period]]">
                 <div class="from">
                    <div class="label">
                        <label for="year">งวดที่ [[item.no]] :</label>
                    </div>
                    <div class="input">
                        [[changeString2Num(item.*,'quality')]]
                        <gl-form-input id='year'no-label-float value="{{item.quality}}" disabled="[[disable]]"></gl-form-input>
                    </div>
                </div>
            </template>
        </div>

    </template>
    <script>
        Polymer({
            is: 'quota-manage',
            behaviors:[ReduxBehavior],
            properties:{
                select:{
                    notify:true
                },
                disable:{
                    statePath:'quota.disable'
                }
            },
            calPeriod (){
                let round= this.select.period.length;
                let total = Number((this.select.quality/round).toFixed(2))
                // console.log(total)
                this.select.period.map((el,index)=>{
                   this.set('select.period.'+index +'.quality', total); 
                })
            },
            changeString2Num (ob, param) {
                //console.log(typeof ob.value);
                if(typeof ob.value == "string"){
                //   console.log(numeral().unformat(ob.value));
                  var pathChange = ob.path.split(".");
                  if(pathChange.length == 2){
                      if(pathChange[1]==param){
                        ob.base[param]=parseFloat(ob.value);
                        // console.log(typeof ob.value);
                      }
                  }
                }
            }
        });
    </script>
</dom-module>
