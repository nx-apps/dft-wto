
<dom-module id="statistics-card-detail">
    <style is="custom-style" include="gl-color gl-styles gl-table iron-flex iron-flex-factors iron-flex-alignment">
     :host {
        display: block;
     }
     div.container{
      @apply(--layout-horizontal);
      @apply(--layout-center-justified);
      @apply(--layout-wrap);
    }
     paper-material {
        margin: 10px;
        background-color: var(--gl-white-color);
        width: 70%;
        /*min-height: 250px;*/
        border-radius: 3px;
        @apply(--layout-vertical);
        @apply(--layout-justified);
     }
     paper-material > div.head {
        padding: 10px;
        font-size: 35px;
        /*margin-bottom: 25px;*/
        text-align: center;
        @apply(--layout-flex);
     }
     paper-material > div.content {
        padding: 10px;
        @apply(--layout-flex-3);
     }
     .text {
         margin-top: 10px;
     }
     .label {
        text-align: right;
     }
     .input {
        text-align: right;
        padding-right: 30px;
     }
     .type {
        text-align: left;
     }
     .label-table {
         padding-top: 30px;
     }
     .table-detail{
         padding-bottom: 30px;
     }
     table.gl-table-default {
        width: 90%;
        border: 1px solid #ddd;
        margin: 15px;
    }
    </style>
    <template>
        <div class="container">
            [[_setData(detail)]]
            <paper-material elevation="1">
                    <div class="head" id="head">
                        [[title]] 
                    </div>
                    <div class="content layout vertical ">
                        <div class="layout horizontal text">
                            <div class="flex label">จำนวนบริษัทนำเข้าข้าวทั้งหมด</div>
                            <div class="flex input">[[dataSeleted.componey]]</div>
                            <div class="flex type">บริษัท</div>
                        </div>
                        <div class="layout horizontal text">
                            <div class="flex label">จำนวนข้าวที่นำเข้าทั้งหมด</div>
                            <div class="flex input">[[dataSeleted.totalRice]]</div>
                            <div class="flex type">ตัน</div>
                        </div>
                        <div class="layout horizontal text">
                            <div class="flex label">นำเข้าข้าว</div>
                            <div class="flex input">[[dataSeleted.riceType]]</div>
                            <div class="flex type">ชนิด</div>
                        </div>
                        <div class="layout horizontal start-justified label-table">
                            <div class="flex label">มีรายละเอียดดังนี้</div>
                            <div class="flex-5"></div>
                        </div>    
                        <div class="layout horizontal center-justified table-detail">
                            <table class="gl-table-default">
                                <thead class="table-head">
                                    <tr>
                                        <th>ลำดับ</th>
                                        <th>ชนิดข้าว</th>
                                        <th>ปริมาณ (ตัน)</th>
                                    </tr>
                                </thead>
                                <tbody class="table-body">
                                    <template is="dom-repeat" items={{dataSeleted.riceTable}} index-as=index>
                                        <tr>
                                            <td>[[_ObcountIndex(index)]]</td>
                                            <td>[[item.name]]</td>
                                            <td>[[item.weight_net_total]]</td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>   
                </paper-material>  
        </div>
    </template>
    <script>
        Polymer({
            is: 'statistics-card-detail',
            behaviors:[ReduxBehavior],
            properties:{
                dataSelected:{
                    type:Object,
                    value:{}
                },
                year:{
                    statePath:'statistics.year',
                },
                settitle: {
                    statePath:'statistics.settitle',
                    observer:'_setYearDetail'
                },
                list:{
                    statePath:'quota.list',
                },
                detail:{
                    statePath:'statistics.list',
                },
                dataSeleted:{
                    type:Object,
                    value:{}
                },
                title:{
                   type:String,
                   value:''
                }
            },
            _setYearDetail(data){
                console.log(data)
                let year = Number(data.year)+543
                this.title ='การนำเข้าข้าวภายในปี '+year
                console.log(data.period != 'undefined')
                if(data.period !== '' && data.period != 'undefined' && data.period != null)
                      this.title ='การนำเข้าข้าวภายในปี '+year +' งวดที่ '+data.period
                console.log(this.$$('.head') )
            },
            _search: function(){

              if (this.dataSelected.quota == 'นอกโควตา') {
                 this.dataSelected.quota = false;
              } else if (this.dataSelected.quota == 'ในโควตา') {
                 this.dataSelected.quota = true;
              }
              if (this.dataSelected.year)
                this.dataSelected.year = this.dataSelected.year - 543

              var str='?';
              for( key in this.dataSelected){
                  if(this.dataSelected[key] != '' && this.dataSelected[key] != null){
                    // if(str==''){str += '?'}else{str += '&'}
                    str += '&'+key+'='+this.dataSelected[key];
                  }
              }
              this.dispatchAction('STATISTICS_SEARCH',str)
              this.dataSelected.year = JSON.parse(JSON.stringify(this.dataSelected.year))+543
            },
            _setData(data){
                this.set('dataSeleted.totalRice',Object.keys(data).reduce((previous, current) => previous + data[current].weight_net , 0))
                let num = new Array()
                let riceType = new Array()
                let nameRice = new Number
                let name = new String
                let riceTable = new Array()
                // คำนวนบริษัท
                data.map((el)=>{
                    num.find((num)=> num == el.receive_tax_id ) == undefined ? num.push(el.receive_tax_id) : '' ;
                    riceType.find((riceType)=> riceType == el.product_code ) == undefined ? riceType.push(el.product_code) : '' ;
                })
                riceType.map((ea,index)=>{
                    nameRice =  data.filter((data)=> data.product_code == ea)
                    riceTable.push({name:nameRice[0].type_rice_name_th,weight_net_total:Object.keys(nameRice).reduce((previous, current) => previous + nameRice[current].weight_net , 0)})
                })
                this.set('dataSeleted.componey',num.length)
                this.set('dataSeleted.riceType',num.length)
                this.set('dataSeleted.riceTable',riceTable)
            },
            _ObcountIndex: function (index) {
                return index + 1;
            },

        });
    </script>
</dom-module>
