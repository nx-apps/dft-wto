
<dom-module id="statistics-card">
    <style include="gl-color ">
     :host {
        display: block;
     }
     div.container{
      @apply(--layout-horizontal);
      @apply(--layout-center-justified);
      @apply(--layout-wrap);
    }
     paper-material {
        margin: 10px;
        background-color: var(--gl-white-color);
        width: 70%;
        min-height: 100px;
        border-radius: 3px;
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-center-justified);
     }
     .buttonSearch {
         width: 70%;
         @apply(--layout-horizontal);
         @apply(--layout-center);
         @apply(--layout-center-justified);
         
     }
    </style>
    <template>
        //[[year]]
        <div class="container">
            <paper-material elevation="1">
                <div class="searchBox searchBorder">
                    <gl-grid-row width="{{getWidth}}">
                    <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                        <gl-form-dropdown-menu label="ปี" placeholder="เลือกปีโควตา">
                        <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{dataSelected.year}}">
                            <paper-item>ทุกปี</paper-item>
                            <template is="dom-repeat" items={{list}} >
                            <paper-item value="[[item.year]]">[[item.year]]</paper-item>
                            </template>
                            
                        </paper-menu>
                        </gl-form-dropdown-menu>
                    </gl-grid-col>
                    <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                        <gl-form-dropdown-menu label="งวด" placeholder="ทั้งหมด">
                        <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{dataSelected.period}}">
                        <paper-item>ทั้งหมด</paper-item>
                        <paper-item value="1">1</paper-item>
                        <paper-item value="2">2</paper-item>
                        <paper-item value="3">3</paper-item>
                        </paper-menu>
                        </gl-form-dropdown-menu>
                    </gl-grid-col>
                    <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                        <gl-form-dropdown-menu label="ชนิดโควตา" placeholder="ทั้งหมด" >
                        <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{dataSelected.quota}}">
                            <paper-item>ทั้งหมด</paper-item>
                            <paper-item value="true">ในโควตา</paper-item>
                            <paper-item value="false">นอกโควตา</paper-item>
                        </paper-menu>
                        </gl-form-dropdown-menu>
                    </gl-grid-col>
                    <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                        <paper-button class="gl-btn-info buttonSearch" on-tap="_search" title="ค้นหา" raised>ค้นหา</paper-button>
                    </gl-grid-col>
                    </gl-grid-row>
                </div> 
            </paper-material>  
        </div>
    </template>
    <script>
        Polymer({
            is: 'statistics-card',
            behaviors:[ReduxBehavior],
            properties:{
                dataSelected:{
                    type:Object,
                    value:{}
                },
                year:{
                    statePath:'statistics.year',
                    observer:'_setYear'
                },
                list:{
                    statePath:'quota.list',
                } 
            },
             _setYear(list){
            
            if(list.length != 0){
                
              this.dataSelected.year = this.year
                this.notifyPath('dataSelected.year');
              }
            },
            _search: function(){
              console.log({quota:this.dataSelected.quota,year:this.dataSelected.year,period:this.dataSelected.period})
              if (this.dataSelected.quota == 'นอกโควตา') {
                 this.dataSelected.quota = false;
              } else if (this.dataSelected.quota == 'ในโควตา') {
                 this.dataSelected.quota = true;
              } 
              if (this.dataSelected.year)
                this.dataSelected.year = this.dataSelected.year - 543

              var str='';
              for( key in this.dataSelected){
                  if(this.dataSelected[key] != '' && this.dataSelected[key] != null){
                    // if(str==''){str += '?'}else{str += '&'}
                    str += '&'+key+'='+this.dataSelected[key];
                  }
              }
              this.dispatchAction('STATISTICS_SEARCH',str)
            //   console.log
            //   this.dispatchAction('STATISTICS_SETSEARCH',{})
              this.dataSelected.year = JSON.parse(JSON.stringify(this.dataSelected.year))+543
            }
            
        });
    </script>
</dom-module>
