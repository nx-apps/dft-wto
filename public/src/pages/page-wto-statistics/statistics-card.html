
<dom-module id="statistics-card">
    <style include="gl-color iron-flex iron-flex-factors iron-flex-alignment">
     :host {
        display: block;
     }
     div.container{
      @apply(--layout-horizontal);
      @apply(--layout-center-justified);
      @apply(--layout-wrap);
    }
    gl-form-dropdown-menu{
        margin: 10px;
    }
     paper-material {
        margin: 10px;
        background-color: var(--gl-white-color);
        width: 70%;
        min-height: 100px;
        border-radius: 3px;
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-center-justified);
     }
     .buttonSearch {
         width: 70%;
         @apply(--layout-horizontal);
         @apply(--layout-center);
         @apply(--layout-center-justified);

     }
    </style>
    <template>
        <!--//[[year]]-->
        <div class="container">
            <paper-material elevation="1">
                <div class="searchBox searchBorder">
                    <gl-grid-row width="{{getWidth}}">
                      <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                          <gl-form-dropdown-menu label="ปี" placeholder="เลือกปีโควตา">
                          <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{dataSelected.year}}">
                              <!-- <paper-item>ทุกปี</paper-item> -->
                              <template is="dom-repeat" items={{list}} >
                              <paper-item value="[[item.year]]">[[item.year]]</paper-item>
                              </template>

                          </paper-menu>
                          </gl-form-dropdown-menu>
                      </gl-grid-col>
                      <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                          <gl-form-dropdown-menu label="ชนิดโควตา" placeholder="ทั้งหมด">
                          <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{dataSelected.quota}}">
                              <paper-item value="all" on-tap="_checkFalseValue">ทั้งหมด</paper-item>
                              <paper-item value="true" on-tap="_checkTrueValue">ในโควตา</paper-item>
                              <paper-item value="false" on-tap="_checkFalseValue">นอกโควตา</paper-item>
                          </paper-menu>
                          </gl-form-dropdown-menu>
                      </gl-grid-col>
                      <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                          <gl-form-dropdown-menu label="งวด" placeholder="ทั้งหมด" disabled="[[setBtn]]">
                          <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{dataSelected.period}}">
                          <paper-item>ทั้งหมด</paper-item>
                          <paper-item value="1">1</paper-item>
                          <paper-item value="2">2</paper-item>
                          <paper-item value="3">3</paper-item>
                          </paper-menu>
                          </gl-form-dropdown-menu>
                      </gl-grid-col>

                      <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]" class="horizontal layout">
                          <div class="buttonSearch flex self-center">
                                <paper-button class="gl-btn-info " on-tap="_search" title="ค้นหา" raised>ค้นหา</paper-button>
                          </div>
                          
                      </gl-grid-col>
                    </gl-grid-row>
                </div>
            </paper-material>
        </div>
    </template>
    <script>
        Polymer({
            is: 'statistics-card',
            behaviors:[ReduxBehavior],
            properties:{
                dataSelected:{
                    type:Object,
                    value:{ quota:'all' }
                },
                year:{
                    statePath:'statistics.year',
                    observer:'_setYear'
                },
                list:{
                    statePath:'quota.list',
                },
                setBtn:{
                    type:Boolean,
                    value:true
                }
            },
            _checkTrueValue(e){
                this.set('setBtn',false)
            },
            _checkFalseValue(e){
                this.set('setBtn',true)
                // this.dataSelected.period = ''
                this.set('dataSelected.period','')
                // delete this.dataSelected.quota;
                // console.log(this.dataSelected.period)
            },
             _setYear(list){
            if(list.length != 0){
              this.dataSelected.year = this.year
                this.notifyPath('dataSelected.year');
              }
            },
            _search: function(){
              // console.log(this.dataSelected.quota);
              // console.log({quota:this.dataSelected.quota,year:this.dataSelected.year,period:this.dataSelected.period})
              if (this.dataSelected.year){
                this.dataSelected.year = this.dataSelected.year - 543
              }
              if (this.dataSelected.quota == 'all') {
                var str='';
                if(this.dataSelected.year != '' && this.dataSelected.year != null){
                  str += '?'+'year'+'='+this.dataSelected.year;
                }
                // console.log(str);
                this.dispatchAction('STATISTICS_LIST_ALL',str)
              } else if (this.dataSelected.quota == 'true') {
                var str='';
                if(this.dataSelected.year != '' && this.dataSelected.year != null){
                  str += '?year='+this.dataSelected.year+'&period='+this.dataSelected.period;
                }
                // console.log(str);
                this.dispatchAction('STATISTICS_LIST_INQUOTA',str)
              } else if (this.dataSelected.quota == 'false') {
                var str='';
                if(this.dataSelected.year != '' && this.dataSelected.year != null){
                  str += '?'+'year'+'='+this.dataSelected.year;
                }
                // console.log(str);
                this.dispatchAction('STATISTICS_LIST_OUTQUOTA',str)
              }

              this.dispatchAction('STATISTICS_SETSEARCH',{quota:this.dataSelected.quota,year:this.dataSelected.year,period:this.dataSelected.period})
              this.dataSelected.year = JSON.parse(JSON.stringify(this.dataSelected.year))+543
            }

        });
    </script>
</dom-module>
